System.register("chunks:///_virtual/Cell.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,n,o,l,c,a,u,s;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){o=e.cclegacy,l=e._decorator,c=e.UITransform,a=e.Rect,u=e.Vec2,s=e.Component}],execute:function(){var p,h,f,d,g,y;o._RF.push({},"224feFXlFxLW7Im62sIX6Qo","Cell",void 0);var b=l.ccclass,w=l.property;e("Cell",b("Cell")((f=t((h=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];return t=e.call.apply(e,[this].concat(o))||this,r(t,"row",f,n(t)),r(t,"col",d,n(t)),r(t,"cellWidth",g,n(t)),r(t,"cellHeight",y,n(t)),t.occupied=!1,t}i(t,e);var o=t.prototype;return o.start=function(){},o.judgePointInside=function(e){var t,i=this.node,r=i.getWorldPosition(),n=(null==(t=i.getComponent(c))?void 0:t.contentSize)||{width:this.cellWidth,height:this.cellHeight},o=new a(r.x-n.width/2,r.y-n.height/2,n.width,n.height),l=new u(e.x,e.y);return o.contains(l)},t}(s)).prototype,"row",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),d=t(h.prototype,"col",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),g=t(h.prototype,"cellWidth",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),y=t(h.prototype,"cellHeight",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),p=h))||p);o._RF.pop()}}}));

System.register("chunks:///_virtual/EditorMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,i,r,a,o,n,s,l,c,d,h,g,m,u,p,f;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,a=e.assertThisInitialized,o=e.asyncToGenerator,n=e.createForOfIteratorHelperLoose,s=e.createClass,l=e.regeneratorRuntime},function(e){c=e.cclegacy,d=e._decorator,h=e.Node,g=e.ImageAsset,m=e.Texture2D,u=e.SpriteFrame,p=e.Sprite,f=e.Component}],execute:function(){var v,S,x,z,w,b,y,I,C,k,E,_,B;c._RF.push({},"cb840KtiSZIUqmc0yg3cuL9","EditorMgr",void 0);var T=d.ccclass,R=d.property;e("EditorMgr",(v=T("EditorMgr"),S=R(h),x=R(h),z=R(h),w=R(h),b=R(g),v((C=t((I=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this).maxSize=400,t.gridSize=8,t.pixelThreshold=150,t.showGrid=!1,t.selectedGrids=new Set,t.lastScale=1,t.lastCenterOffset=[0,0],t.curImage=null,t.blockCanvas=null,t.gridColors=["rgba(255,255,0,0.4)","rgba(255,165,0,0.4)","rgba(0,255,0,0.4)","rgba(0,128,255,0.4)","rgba(128,0,255,0.4)","rgba(255,0,0,0.4)","rgba(0,255,255,0.4)"],t.colorIndex=0,t.colorGridMap=[new Set,new Set,new Set,new Set,new Set,new Set,new Set],r(t,"imageNode",C,a(t)),r(t,"loadBtn",k,a(t)),r(t,"cutBtn",E,a(t)),r(t,"saveBtn",_,a(t)),r(t,"blockPng",B,a(t)),t}i(t,e);var c=t.prototype;return c.isGridLocked=function(e,t){for(var i=0;i<this.gridColors.length;i++)if(i!==this.colorIndex&&this.colorGridMap[i].has(e+"-"+t))return!0;return!1},c.start=function(){},c.onClickLoadPic=function(){var e=this,t=document.createElement("input");t.type="file",t.accept=".png,image/png",t.style.display="none",document.body.appendChild(t),t.onchange=o(l().mark((function i(){var r,a,n;return l().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=null==(r=t.files)?void 0:r[0]){i.next=3;break}return i.abrupt("return");case 3:(n=new FileReader).onload=function(i){var r,a=new Image;a.onload=o(l().mark((function i(){return l().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.adjustImage(a);case 2:document.body.removeChild(t),e.loadBtn.active=!1,e.cutBtn.active=!0,e.saveBtn.active=!0;case 6:case"end":return i.stop()}}),i)}))),a.src=null==(r=i.target)?void 0:r.result},n.readAsDataURL(a);case 6:case"end":return i.stop()}}),i)}))),t.click()},c.onClickLoadPicFromPath=function(){},c.resizeImage=function(e){var t=this,i=e.width,r=e.height,a=1;a=i>=r?this.maxSize/i:this.maxSize/r;var o=Math.round(i*a),n=Math.round(r*a),s=document.createElement("canvas");s.width=o,s.height=n,s.getContext("2d").drawImage(e,0,0,o,n);var l=new Image;l.onload=function(){var e=new m,i=new g(l);e.image=i;var r=new u;r.texture=e;var a=t.imageNode.getComponent(p);a&&(a.spriteFrame=r)},l.src=s.toDataURL()},c.gridCutImgae=function(){},c.getGridPixelData=function(e){var t=this.maxSize/this.gridSize,i=this.gridSize,r=document.createElement("canvas");r.width=this.maxSize,r.height=this.maxSize;var a=r.getContext("2d"),o=1;o=e.width>=e.height?this.maxSize/e.width:this.maxSize/e.height;var n=e.width*o,s=e.height*o,l=(this.maxSize-n)/2,c=(this.maxSize-s)/2;if(a.clearRect(0,0,this.maxSize,this.maxSize),a.drawImage(e,l,c,n,s),this.showGrid){a.save(),a.strokeStyle="rgb(255, 0, 0)",a.lineWidth=1;for(var d=0;d<=i;d++)a.beginPath(),a.moveTo(d*t,0),a.lineTo(d*t,this.maxSize),a.stroke(),a.beginPath(),a.moveTo(0,d*t),a.lineTo(this.maxSize,d*t),a.stroke();a.restore(),r.style.position="absolute",r.style.top="10px",r.style.left="10px",r.style.zIndex="9999",document.body.appendChild(r)}for(var h=[],g=0;g<i;g++){h[g]=[];for(var m=0;m<i;m++){var u=a.getImageData(m*t,g*t,t,t);h[g][m]=u.data}}return h},c.countImagePixelsInGrid=function(e,t,i){for(var r=e[t][i],a=0,o=0;o<r.length;o+=4)r[o+3]>0&&a++;return a},c.adjustImage=function(){var e=o(l().mark((function e(t){var i,r,a,o,n,s,c,d,h,f,v,S,x,z,w,b,y,I,C,k,E,_,B,T,R,M,P,G,N,O,L,D,j=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0,r=0,a=40,o=5,n=1,s=0,c=null;case 7:if(!(s<a)){e.next=55;break}for((d=document.createElement("canvas")).width=this.maxSize,d.height=this.maxSize,h=d.getContext("2d"),f=1,f=t.width>=t.height?this.maxSize/t.width:this.maxSize/t.height,f*=n,v=t.width*f,S=t.height*f,x=(this.maxSize-v)/2,z=(this.maxSize-S)/2,h.clearRect(0,0,this.maxSize,this.maxSize),h.drawImage(t,x+i,z+r,v,S),w=this.maxSize/this.gridSize,b=[],y=0;y<this.gridSize;y++)for(b[y]=[],I=0;I<this.gridSize;I++)C=h.getImageData(I*w,y*w,w,w),b[y][I]=C.data;for(k=[],E=0;E<this.gridSize;E++)for(_=0;_<this.gridSize;_++)(B=this.countImagePixelsInGrid(b,E,_))<this.pixelThreshold&&B>20&&k.push({row:E,col:_,count:B});if(console.log("Not Enough:",k),!(k.length<3&&k.length>0)){e.next=35;break}return n*=.96,console.log("Scale Down:",n),c=d,e.abrupt("continue",52);case 35:if(0!==k.length){e.next=38;break}return c=d,e.abrupt("break",55);case 38:if(k.sort((function(e,t){return t.count-e.count})),T=k[0],R=(T.col+.5)*w,M=(T.row+.5)*w,P=this.maxSize/2+i,G=this.maxSize/2+r,N=R-P,O=M-G,0!==(L=Math.sqrt(N*N+O*O))){e.next=49;break}return e.abrupt("break",55);case 49:i+=Math.round(N/L*o),r+=Math.round(O/L*o),c=d;case 52:s++,e.next=7;break;case 55:c&&((D=new Image).onload=function(){var e=new m,t=new g(D);e.image=t;var i=new u;i.texture=e;var r=j.imageNode.getComponent(p);r&&(r.spriteFrame=i),j.showGridCanvas(D)},D.src=c.toDataURL(),this.curImage=D,this.lastScale=n,this.lastCenterOffset=[i,r],this.showBlockLayer());case 56:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),c.showImageWithOverflow=function(e,t,i){var r=600,a=this.maxSize/this.gridSize,o=document.createElement("canvas");o.width=r,o.height=r;var n=o.getContext("2d"),s=1;s=e.width>=e.height?this.maxSize/e.width:this.maxSize/e.height;var l=e.width*s,c=e.height*s,d=300,h=300,g=d-l/2+t,m=h-c/2+i;n.drawImage(e,g,m,l,c),n.save(),n.strokeStyle="red",n.lineWidth=2,n.strokeRect(100,100,400,400),n.strokeStyle="rgba(255,0,0,0.5)",n.lineWidth=1;for(var u=0;u<=this.gridSize;u++)n.beginPath(),n.moveTo(100+u*a,100),n.lineTo(100+u*a,500),n.stroke(),n.beginPath(),n.moveTo(100,100+u*a),n.lineTo(500,100+u*a),n.stroke();n.restore(),o.style.position="absolute",o.style.top="10px",o.style.left="10px",o.style.zIndex="9999",document.body.appendChild(o)},c.showGridCanvas=function(e){var t=this,i=this.maxSize/this.gridSize,r=this.gridSize,a=document.createElement("canvas");a.width=this.maxSize,a.height=this.maxSize;var o=a.getContext("2d"),s=1;s=e.width>=e.height?this.maxSize/e.width:this.maxSize/e.height;var l=e.width*s,c=e.height*s,d=(this.maxSize-l)/2,h=(this.maxSize-c)/2,g=function(){o.clearRect(0,0,t.maxSize,t.maxSize),o.drawImage(e,d,h,l,c);for(var a=0;a<t.gridColors.length;a++)for(var s,g=n(t.colorGridMap[a]);!(s=g()).done;){var m=s.value.split(",").map(Number),u=m[0],p=m[1];o.save(),o.fillStyle=t.gridColors[a],o.fillRect(p*i,u*i,i,i),o.restore()}for(var f,v=n(t.currentColorSet);!(f=v()).done;){var S=f.value.split(",").map(Number),x=S[0],z=S[1];o.save(),o.fillStyle=t.gridColors[t.colorIndex],o.fillRect(z*i,x*i,i,i),o.restore()}o.save(),o.strokeStyle="rgba(255, 255, 255, 0.5)",o.lineWidth=1;for(var w=0;w<=r;w++)o.beginPath(),o.moveTo(w*i,0),o.lineTo(w*i,t.maxSize),o.stroke(),o.beginPath(),o.moveTo(0,w*i),o.lineTo(t.maxSize,w*i),o.stroke();o.restore()};g(),a.onclick=function(e){var o=a.getBoundingClientRect(),n=e.clientX-o.left,s=e.clientY-o.top,l=Math.floor(n/i),c=Math.floor(s/i),d=c+","+l;if(c>=0&&c<r&&l>=0&&l<r){if(t.isGridLocked(c,l))return;t.currentColorSet.has(d)?t.currentColorSet.delete(d):t.currentColorSet.add(d),g()}},a.style.position="fixed",a.style.top="50%",a.style.left="50%",a.style.transform="translate(-50%, -50%)",a.style.zIndex="9999",document.body.appendChild(a)},c.showSelectedGridImages=function(){var e=this.maxSize/this.gridSize,t=this.currentColorSet;if(0!==t.size){for(var i,r=this.gridSize,a=-1,o=this.gridSize,s=-1,l=n(t);!(i=l()).done;){var c=i.value.split(",").map(Number),d=c[0],h=c[1];d<r&&(r=d),d>a&&(a=d),h<o&&(o=h),h>s&&(s=h)}if(!(r>a||o>s)){var g=(s-o+1)*e,m=(a-r+1)*e,u=document.createElement("canvas");u.width=this.maxSize,u.height=this.maxSize;for(var p=u.getContext("2d"),f=this.blockPng.data,v=0;v<this.gridSize;v++)for(var S=0;S<this.gridSize;S++)p.drawImage(f,S*e,v*e,e,e);p.globalCompositeOperation="destination-in",p.drawImage(this.curImage,0,0,this.maxSize,this.maxSize),p.globalCompositeOperation="source-over";var x=document.createElement("canvas");x.width=g,x.height=m;var z=x.getContext("2d");z.clearRect(0,0,g,m);for(var w,b=n(t);!(w=b()).done;){var y=w.value.split(",").map(Number),I=y[0],C=y[1],k=(C-o)*e,E=(I-r)*e,_=p.getImageData(C*e,I*e,e,e);z.putImageData(_,k,E)}var B=document.getElementById("selected-grid-container");B||((B=document.createElement("div")).id="selected-grid-container",B.style.position="fixed",B.style.top="10px",B.style.right="10px",B.style.zIndex="10000",B.style.background="rgba(255,255,255,0.9)",B.style.padding="10px",B.style.borderRadius="8px",B.style.display="flex",B.style.flexDirection="column",B.style.maxHeight="90vh",B.style.overflowY="auto",document.body.appendChild(B));var T=new Image,R=x.toDataURL();T.src=R,T.style.display="block",T.style.margin="0 auto",T.style.border="1px solid #ccc",T.width=g,T.height=m;var M=document.createElement("div");M.style.display="inline-block",M.style.margin="6px",M.style.padding="4px",M.style.background="#f8f8f8",M.style.border="1px solid #eee",M.style.borderRadius="6px",M.appendChild(T),B.appendChild(M);var P=[],G=localStorage.getItem("jigsaw_cuts_cache");G&&(P=JSON.parse(G)),P.push(R),localStorage.setItem("jigsaw_cuts_cache",JSON.stringify(P));var N={},O=localStorage.getItem("jigsaw_cuts");O&&(N=JSON.parse(O));var L=localStorage.getItem("jigsaw_origin_id")||"1001";N[L]||(N[L]={cuts:[]});for(var D,j=[],F=n(this.currentColorSet);!(D=F()).done;){var J=D.value.split(",").map(Number),W=J[0],U=J[1];j.push([W,U])}var A=N[L].cuts.length+1;N[L].cuts.push({filename:L+"_cuts_"+A,grid_coords:j}),localStorage.setItem("jigsaw_cuts",JSON.stringify(N)),this.colorIndex=(this.colorIndex+1)%this.gridColors.length,this.colorIndex>=this.colorGridMap.length&&this.colorGridMap.push(new Set),this.currentColorSet.clear()}}},c.saveAllImagesToLocal=function(){var e=o(l().mark((function e(){var t,i,r,a,o,n,s,c,d,h,g,m;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=1001,i="jigsaw_origin_id",r="jigsaw_origin",(a=localStorage.getItem(i))&&(t=parseInt(a,10)+1),localStorage.setItem(i,t.toString()),this.curImage&&((o=document.createElement("a")).href=this.curImage.src,o.download="origin_"+t+".png",document.body.appendChild(o),o.click(),document.body.removeChild(o),n={},(s=localStorage.getItem(r))&&(n=JSON.parse(s)),n[t]={filename:"origin_"+t+".png",scale:this.lastScale,center_offset:this.lastCenterOffset},localStorage.setItem(r,JSON.stringify(n))),c=document.getElementById("selected-grid-container"))for(d=c.getElementsByTagName("img"),h=0;h<d.length;h++)g=d[h],(m=document.createElement("a")).href=g.src,m.download=t+"_cuts_"+(h+1)+".png",document.body.appendChild(m),m.click(),document.body.removeChild(m);alert("图片已保存为下载文件\n原图: origin_"+t+".png\n裁切: "+t+"_cuts_1.png ...");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),c.showBlockLayer=function(){var e=this,t=this.maxSize/this.gridSize,i=document.createElement("canvas");i.width=this.maxSize,i.height=this.maxSize;var r=i.getContext("2d"),a=new Image;a.src=this.blockPng.data.src,a.onload=function(){for(var o=0;o<e.gridSize;o++)for(var n=0;n<e.gridSize;n++)r.drawImage(a,n*t,o*t,t,t);var s=document.createElement("canvas");s.width=e.maxSize,s.height=e.maxSize,s.getContext("2d").drawImage(e.curImage,0,0,e.maxSize,e.maxSize),r.globalCompositeOperation="destination-in",r.drawImage(s,0,0),r.globalCompositeOperation="source-over",i.style.position="fixed",i.style.top="50%",i.style.left="50%",i.style.transform="translate(-50%, -50%)",i.style.zIndex="10000",document.body.appendChild(i),e.blockCanvas=i,e.bindBlockCanvasEvents(i)}},c.cutImageShapeOnBlock=function(e){var t=e.getContext("2d"),i=document.createElement("canvas");i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(this.curImage,0,0,this.maxSize,this.maxSize),t.globalCompositeOperation="destination-out",t.drawImage(i,0,0),t.globalCompositeOperation="source-over",t.drawImage(this.curImage,0,0,this.maxSize,this.maxSize),e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.zIndex="10000",document.body.appendChild(e),this.bindBlockCanvasEvents(e)},c.bindBlockCanvasEvents=function(e){var t=this,i=this.maxSize/this.gridSize;e.onclick=function(r){var a=e.getBoundingClientRect(),o=r.clientX-a.left,n=r.clientY-a.top,s=Math.floor(o/i),l=Math.floor(n/i),c=l+","+s;if(l>=0&&l<t.gridSize&&s>=0&&s<t.gridSize){if(t.isGridLocked(l,s))return;t.currentColorSet.has(c)?t.currentColorSet.delete(c):t.currentColorSet.add(c),t.redrawBlockSelection(e)}}},c.redrawBlockSelection=function(e){var t=e.getContext("2d"),i=this.maxSize/this.gridSize,r=this.gridSize,a=this.blockPng.data;t.clearRect(0,0,this.maxSize,this.maxSize);for(var o=0;o<r;o++)for(var s=0;s<r;s++)t.drawImage(a,s*i,o*i,i,i);t.globalCompositeOperation="destination-in",t.drawImage(this.curImage,0,0,this.maxSize,this.maxSize),t.globalCompositeOperation="source-over";for(var l=0;l<this.gridColors.length;l++)for(var c,d=n(this.colorGridMap[l]);!(c=d()).done;){var h=c.value.split(",").map(Number),g=h[0],m=h[1];t.save(),t.fillStyle=this.gridColors[l],t.fillRect(m*i,g*i,i,i),t.restore()}for(var u,p=n(this.currentColorSet);!(u=p()).done;){var f=u.value.split(",").map(Number),v=f[0],S=f[1];t.save(),t.fillStyle=this.gridColors[this.colorIndex],t.fillRect(S*i,v*i,i,i),t.restore()}t.save(),t.strokeStyle="rgba(255,255,255,0.5)",t.lineWidth=1;for(var x=0;x<=r;x++)t.beginPath(),t.moveTo(x*i,0),t.lineTo(x*i,this.maxSize),t.stroke(),t.beginPath(),t.moveTo(0,x*i),t.lineTo(this.maxSize,x*i),t.stroke();t.restore()},s(t,[{key:"currentColorSet",get:function(){return this.colorGridMap[this.colorIndex]}}]),t}(f)).prototype,"imageNode",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=t(I.prototype,"loadBtn",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(I.prototype,"cutBtn",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(I.prototype,"saveBtn",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(I.prototype,"blockPng",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=I))||y));c._RF.pop()}}}));

System.register("chunks:///_virtual/GameMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UtilResLoad.ts"],(function(t){var e,n,r,o,a,i,s,u,c,l,g,f,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,r=t.initializerDefineProperty,o=t.assertThisInitialized,a=t.asyncToGenerator,i=t.regeneratorRuntime},function(t){s=t.cclegacy,u=t._decorator,c=t.Prefab,l=t.Node,g=t.instantiate,f=t.Component},function(t){p=t.UtilResLoad}],execute:function(){var m,d,h,y,z,b,C,v;s._RF.push({},"3ab2bJzlypJBKmuAXwb4ib/","GameMgr",void 0);var I=u.ccclass,P=u.property;t("GameMgr",(m=I("GameMgr"),d=P(c),h=P(l),m(((v=function(t){function e(){for(var e,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a))||this,r(e,"uiPuzzleStage",b,o(e)),r(e,"startBtnNode",C,o(e)),e}n(e,t);var s=e.prototype;return s.onLoad=function(){var t=a(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.loadConfig("cuts");case 2:return e.configCuts=t.sent,t.next=5,p.loadConfig("images");case 5:return e.configImages=t.sent,t.next=8,p.loadImage("image_shadow","origins");case 8:e.testImg=t.sent,console.log("GameMgr.testImg",e.testImg),e.testCuts=e.configCuts[e.testId].cuts,console.log("GameMgr.testCuts",e.testCuts);case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),s.onClickPuzzleStage=function(){g(this.uiPuzzleStage).setParent(this.node),this.startBtnNode.active=!1},e}(f)).configCuts=null,v.configImages=null,v.testImg=null,v.testId="1001",v.testCuts=null,b=e((z=v).prototype,"uiPuzzleStage",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=e(z.prototype,"startBtnNode",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=z))||y));s._RF.pop()}}}));

System.register("chunks:///_virtual/Global.ts",["cc"],(function(c){var t;return{setters:[function(c){t=c.cclegacy}],execute:function(){t._RF.push({},"12a2bFSPM5AH7EqytDmEyRz","Global",void 0);c("SAVE_DIR","D:/cocos_cache");t._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./EditorMgr.ts","./GameMgr.ts","./PuzzleMgr.ts","./Cell.ts","./Piece.ts","./Puzzle.ts","./Global.ts","./UtilResLoad.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/Piece.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Cell.ts"],(function(o){var e,t,i,n,s,r,l,c,h,a,d,u,p;return{setters:[function(o){e=o.applyDecoratedDescriptor,t=o.inheritsLoose,i=o.initializerDefineProperty,n=o.assertThisInitialized,s=o.createForOfIteratorHelperLoose},function(o){r=o.cclegacy,l=o._decorator,c=o.Node,h=o.Vec3,a=o.Vec2,d=o.UITransform,u=o.Component},function(o){p=o.Cell}],execute:function(){var T,f,v,g,C,y,E;r._RF.push({},"d60174CJDFL9q9kx8TTCPRh","Piece",void 0);var P=l.ccclass,_=l.property;o("Piece",(T=P("Piece"),f=_(c),v=_(c),T((y=e((C=function(o){function e(){for(var e,t=arguments.length,s=new Array(t),r=0;r<t;r++)s[r]=arguments[r];return e=o.call.apply(o,[this].concat(s))||this,i(e,"cellNode",y,n(e)),i(e,"imgNode",E,n(e)),e.initialPosition=new h,e.startPosition=new h,e.gridCoords=[],e.gridCells=[],e.cellsSize=[],e.puzzleMgr=null,e}t(e,o);var r=e.prototype;return r.onLoad=function(){this.node.on(c.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(c.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(c.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(c.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},r.onDestroy=function(){this.node.off(c.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(c.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(c.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(c.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},r.start=function(){this.startPosition=this.node.position.clone()},r.onTouchStart=function(o){this.initialPosition=this.node.position.clone(),console.log("Touch started")},r.onTouchMove=function(o){var e=o.getDelta();this.node.setPosition(this.node.position.add(new h(e.x,e.y,0))),console.log("Touch moving")},r.onTouchEnd=function(o){if(console.log("Touch ended"),this.puzzleMgr){var e=this.node.getWorldPosition(),t=this.puzzleMgr.getCellByWorldPos(new a(e.x,e.y));if(t&&!t.occupied){var i=t.node.getWorldPosition(),n=this.node.parent.parent;if(n){var s=n.getComponent(d).convertToNodeSpaceAR(i);this.node.setPosition(s)}t.occupied=!0}else this.node.setPosition(this.initialPosition)}},r.layoutCells=function(){for(var o,e=1/0,t=1/0,i=s(this.gridCoords);!(o=i()).done;){var n=o.value;e=Math.min(e,n[0]),t=Math.min(t,n[1])}for(var r,l=s(this.gridCoords);!(r=l()).done;){var a=r.value,d=a[0],u=a[1],T=new c("cell_"+d+"_"+u);T.parent=this.cellNode;var f=T.addComponent(p),v=(d-e)*f.cellWidth-(this.cellsSize[0]-1)*f.cellWidth/2,g=-(u-t)*f.cellHeight+(this.cellsSize[1]-1)*f.cellHeight/2;T.setPosition(new h(v,g,0)),this.gridCells.push(f)}},e}(u)).prototype,"cellNode",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(C.prototype,"imgNode",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=C))||g));r._RF.pop()}}}));

System.register("chunks:///_virtual/Puzzle.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n,r,o;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,r=t._decorator,o=t.Component}],execute:function(){var u;n._RF.push({},"0aa62seD75KqZbXybvChwyr","Puzzle",void 0);var c=r.ccclass;r.property,t("Puzzle",c("Puzzle")(u=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.start=function(){},r.update=function(t){},n}(o))||u);n._RF.pop()}}}));

System.register("chunks:///_virtual/PuzzleMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Cell.ts","./GameMgr.ts","./UtilResLoad.ts","./Piece.ts"],(function(e){var t,i,r,o,n,l,a,s,c,d,u,h,g,p,m,f,C,z,b,v,w;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized,n=e.createForOfIteratorHelperLoose,l=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,c=e._decorator,d=e.Node,u=e.Prefab,h=e.SpriteFrame,g=e.Sprite,p=e.UITransform,m=e.Vec3,f=e.Component,C=e.instantiate},function(e){z=e.Cell},function(e){b=e.GameMgr},function(e){v=e.UtilResLoad},function(e){w=e.Piece}],execute:function(){var y,P,N,S,M,x,H,I,W,k,R,_,F,G,L;s._RF.push({},"72c85MSXatCgYAxiXv0pnGG","PuzzleMgr",void 0);var A=c.ccclass,B=c.property;e("PuzzleMgr",(y=A("PuzzleMgr"),P=B(d),N=B(d),S=B(d),M=B(d),x=B(u),H=B(h),y((k=t((W=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return t=e.call.apply(e,[this].concat(n))||this,r(t,"puzzleNode",k,o(t)),r(t,"pieceSideNode",R,o(t)),r(t,"gridNode",_,o(t)),r(t,"imageNode",F,o(t)),r(t,"piecePrefab",G,o(t)),r(t,"blockImg",L,o(t)),t.gridRows=8,t.gridCols=8,t.cellWidth=50,t.cellHeight=50,t.blockShow=!0,t}i(t,e);var s=t.prototype;return s.onLoad=function(){},s.start=function(){this.generateGrid(),this.loadPuzzleImage(b.testImg,0,0),this.loadCuts()},s.generateGrid=function(){this.gridNode.removeAllChildren();for(var e=this.gridCols*this.cellWidth,t=this.gridRows*this.cellHeight,i=0;i<this.gridRows;i++)for(var r=0;r<this.gridCols;r++){var o=new d("cell_"+i+"_"+r);o.setPosition(r*this.cellWidth-e/2+this.cellWidth/2,-(i*this.cellHeight-t/2+this.cellHeight/2));var n=o.addComponent(z);if(n.cellWidth=this.cellWidth,n.cellHeight=this.cellHeight,n.row=i,n.col=r,this.gridNode.addChild(o),this.blockShow)o.addComponent(g).spriteFrame=this.blockImg,o.getComponent(p).setContentSize(this.cellWidth,this.cellHeight)}},s.loadPuzzleImage=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0);var r=this.imageNode.getComponent(g);r&&(r.spriteFrame=e);var o=this.gridCols*this.cellWidth,n=this.gridRows*this.cellHeight,l=Math.max(o,n),a=e.texture,s=a.width,c=a.height,d=l/Math.max(s,c),u=this.imageNode.getComponent(p);u&&(u.width=s*d,u.height=c*d);var h=s*d,f=c*d,C=new m(o/2,-n/2,0);this.imageNode.setPosition(C.x+t-h/2,C.y+i+f/2,0)},s.loadCuts=function(){var e=l(a().mark((function e(){var t,i,r,o,l,s,c,d,u,h,m,f,z,y;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<b.testCuts.length)){e.next=25;break}return i=b.testCuts[t],(r=C(this.piecePrefab)).setParent(this.pieceSideNode),(o=r.getComponent(w)).puzzleMgr=this,e.next=9,v.loadImage(i.filename,"cuts");case 9:for(l=e.sent,o.imgNode.getComponent(g).spriteFrame=l,o.gridCoords=i.grid_coords,s=o.gridCoords[0][0],c=o.gridCoords[0][1],d=o.gridCoords[0][0],u=o.gridCoords[0][1],h=n(o.gridCoords);!(m=h()).done;)f=m.value,z=f[0],y=f[1],s=Math.min(s,z),c=Math.min(c,y),d=Math.max(d,z),u=Math.max(u,y);o.cellsSize=[d-s+1,u-c+1],r.getChildByName("cells_node").getComponent(p).setContentSize(o.cellsSize[0]*this.cellWidth,o.cellsSize[1]*this.cellHeight),r.getComponent(p).setContentSize(o.cellsSize[0]*this.cellWidth,o.cellsSize[1]*this.cellHeight),o.layoutCells();case 22:t++,e.next=1;break;case 25:case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.getCellByWorldPos=function(e){for(var t,i=n(this.gridNode.children);!(t=i()).done;){var r=t.value.getComponent(z);if(r&&r.judgePointInside(new m(e.x,e.y,0)))return r}return null},t}(f)).prototype,"puzzleNode",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=t(W.prototype,"pieceSideNode",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=t(W.prototype,"gridNode",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=t(W.prototype,"imageNode",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(W.prototype,"piecePrefab",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(W.prototype,"blockImg",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=W))||I));s._RF.pop()}}}));

System.register("chunks:///_virtual/UtilResLoad.ts",["cc"],(function(n){var o,e,r,t,c;return{setters:[function(n){o=n.cclegacy,e=n._decorator,r=n.resources,t=n.JsonAsset,c=n.SpriteFrame}],execute:function(){var i;o._RF.push({},"d01caZnSg1FmaH/dcAz3ATK","UtilResLoad",void 0);var s=e.ccclass;n("UtilResLoad",s("UtilResLoad")(i=function(){function n(){}return n.loadConfig=function(n){var o="config/"+n;return new Promise((function(n,e){r.load(o,t,(function(o,r){o||!r?e(o||new Error("JsonAsset not found")):n(r.json)}))}))},n.loadImage=function(n,o){var e="image/"+o+"/"+n+"/spriteFrame";return new Promise((function(n,o){r.load(e,c,(function(e,r){e||!r?o(e||new Error("SpriteFrame not found")):n(r)}))}))},n}())||i);o._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});